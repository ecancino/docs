---
title: 'Upgrade to Prisma 5'
metaTitle: 'Upgrade to Prisma 5'
metaDescription: 'Guides on how to upgrade to Prisma 5'
tocDepth: 3
toc: true
---

<TopBlock>

Prisma 5.0.0 introduces a number of changes, including the usage of our new JSON Protocol, [which make Prisma faster by default](https://www.prisma.io/blog/prisma-and-serverless-73hbgKnZ6t#improved-startup-performance-by-9x). A full list of these changes can be found [in our release notes](https://github.com/prisma/prisma/releases/tag/5.0.0).

This guide explains how upgrading might affect your application and gives instructions on how to handle breaking changes within Prisma 5.

</TopBlock>

## Breaking changes

This section gives an overview of major breaking changes in Prisma 5.

### Node.js minimum version change

From Prisma version 5.0.0, the minimum version of Node.js supported is 16.13.0. If your project uses an earlier version of Node.js, you will need to upgrade it.

See our [system requirements](/reference/system-requirements) for all minimum version requirements.

<Admonition type="info">

Node.js v16.x is reaching [end-of-life on 11 September 2023](https://nodejs.org/en/blog/announcements/nodejs16-eol) in order to coincide with the end-of-life of OpenSSL 1.1.1. For that reason, we recommend upgrading to the current Node.js LTS, v18.x. Please note that Prisma 5 will be the last major version of Prisma to support Node.js v16.

</Admonition>

### PostgreSQL minimum version change

From Prisma version 5.0.0, the minimum version of PostgreSQL supported is version 9.6. If your project uses an earlier version of PostgreSQL, you will need to upgrade it.

### Removal of array shortcuts

This version drops support for a number of "array shortcuts". These shortcuts were a way to add a single element as a value to an array-based operator instead of wrapping that one element in an array. To make our typings more consistent and logical, we now require array values for these operators.

In most cases, the fix will be as simple as wrapping the existing value in an array. Below are some specific examples of needed changes in Prisma 5.

#### <inlinecode>OR</inlinecode> operators

The following code in Prisma 4 and lower:

```js
prisma.user.findMany({
  where: {
    OR: { email: 'foo@example.com' },
  }
})
```

Will need to be changed to the following in Prisma 5:

```js highlight=3;edit
prisma.user.findMany({
  where: {
    OR: [{ email: 'foo@example.com' }],
  }
})
```

`OR` operators will only accept array values.

#### <inlinecode>in</inlinecode> and <inlinecode>notIn</inlinecode> operators

Similar to `OR`, `in` and `notIn` require array values.

Prisma 4 and lower:

```js
prisma.user.findMany({
  where: {
    id: { in: 123 },
  }
})

prisma.user.findMany({
  where: {
    id: { notIn: 123 },
  }
})
```

Prisma 5:

```js highlight=4,12;edit
prisma.user.findMany({
  where: {
    id: {
      in: [123],
    },
  }
})

prisma.user.findMany({
  where: {
    id: {
      notIn: [123],
    },
  }
})
```

If your `in` and `notIn` values are only one element, you can also update your code to not use these operators at all:

```js highlight=3,9;normal
prisma.user.findMany({
  where: {
    id: 123,
  }
})

prisma.user.findMany({
  where: {
    id: { not: 123 },
  }
})
```

#### <inlinecode>path</inlinecode> argument for filtering on JSON fields in PostgreSQL

[When filtering on JSON fields in a PostgreSQL table](https://www.prisma.io/docs/concepts/components/prisma-client/working-with-fields/working-with-json-fields#filter-on-a-json-field) the `path` argument now only accepts an array.

When using the following schema:

```prisma
datasource db {
  provider = "postgresql"
}

model User {
  id       String @id
  settings Json
}
```

Prisma 4 and lower:

```js
prisma.user.findMany({
  where: {
    settings: {
      path: 'someSetting',
      equals: someValue,
    },
  },
})
```

Prisma 5:

```js highlight=4;edit
prisma.user.findMany({
  where: {
    settings: {
      path: ['someSetting'],
      equals: someValue,
    },
  },
})
```

<Admonition type="info">

Note: This change only affects PostgreSQL databases. MySQL databases are not affected.

</Admonition>

#### Composite and Scalar lists

Inputs for operations on lists of [Composite](https://www.prisma.io/docs/concepts/components/prisma-schema/data-model#defining-composite-types) and [Scalar](https://www.prisma.io/docs/concepts/components/prisma-schema/data-model#scalar-fields) types now only accept array values. The following examples all use the following schema:

```prisma
model Post {
  id String @id @default(uuid())
  commentsList Comment[]
  tags String[]
}

type Comment {
  text String
}
```

##### Composite list filtering

[When filtering records based on a composite list field](https://www.prisma.io/docs/concepts/components/prisma-client/composite-types#finding-records-that-contain-composite-types-with-find-and-findmany) you will only be able to supply array values.

Prisma 4 and lower:

```js
prisma.post.findMany({
  commentsList: { equals: { text: 'hello' } },
})
```

Prisma 5:

```js highlight=2-4;normal
prisma.post.findMany({
  commentsList: {
    equals: [{ text: 'hello' }],
  },
})
```

##### Composite list input

If you exclude `equals`, you still must supply an array value for composite list fields.

Prisma 4 and lower:

```js
prisma.post.findMany({
  commentsList: { text: 'hello' },
})
```

Prisma 5:

```js highlight=2;normal
prisma.post.findMany({
  commentsList: [{ text: 'hello' }],
})
```

##### Scalar lists

Scalar list values must be arrays in all operations.

Prisma 4 and lower:

```js
prisma.post.create({
  data: { tags: 'databases' },
})

prisma.post.findMany({
  where: { tags: 'databases' },
})
```

Prisma 5:

```js highlight=3,9;edit
prisma.post.create({
  data: {
    tags: ['databases'],
  },
})

prisma.post.findMany({
  where: {
    tags: ['databases'],
  },
})
```

### Prisma Client embedded SQLite version updated

With Prisma version 5.0.0, we have upgraded the embedded version of SQLite from `3.35.4` to `3.41.2`. We did not see any breaking changes and don't anticipate any changes needed in user projects, but if you are using SQLite, make sure to check [the SQLite changelog](https://www.sqlite.org/changes.html)

### Removal of <inlinecode>jsonProtocol</inlinecode> preview feature

The `jsonProtocol` preview feature is now generally available! When upgrading to Prisma 5, make sure to remove `jsonProtocol` from your preview features, if added.

Prisma 4 and lower:

```prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["jsonProtocol", "tracing"]
}
```

Prisma 5:

```prisma highlight=3;delete
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["tracing"]
}
```

In addition, several error messages have been improved. The following error message in Prisma 4 and below

```text
Argument bool: Got invalid value 'true' on prisma.createOneD. Provided String, expected Boolean.
Argument byteA: Got invalid value 'hello prisma ‚ö°Ô∏èüöÄ' on prisma.createOneD. Provided String, expected Bytes.
Argument xml: Got invalid value 123 on prisma.createOneD. Provided Int, expected String.
```

becomes the following in Prisma 5:

```text
Argument `bool`: Invalid value provided. Expected Boolean, provided String.
```

### <inlinecode>cockroachdb</inlinecode> provider is now required when connecting to a CockroachDB database

### Removal of <inlinecode>runtime/index.js</inlinecode> from generated client

#### Using public APIs from <inlinecode>runtime/index.js</inlinecode>

Importing from `@prisma/client/runtime` is no longer available in Prisma 5. If you are using public APIs available in this namespace you can instead import `Prisma` and access them. For example:

```js
import { Decimal } from '@prisma/client/runtime'
```

will need to be changed to

```js
import { Prisma } from '@prisma/client'
Prisma.Decimal
```

#### Using private APIs for a specific runtime

Instead of importing private APIs from the top-level `@prisma/client/runtime` you will need to import from the runtime specific to your database engine. For example:

```text
@prisma/client/runtime/data-proxy
```

## Other changes

The following changes may cause an application to initially throw an error message after upgrading to Prisma 5. Fortunately, they are easy to solve, as the underlying functionality has been removed for a while or the change is a simple string replace.

### Removal of deprecated Prisma CLI flags

Several deprecated CLI flags have been removed.

- `--preview-feature` used in `db execute`, `db seed`, and `db diff`
- `--experimental` and `--early-access-feature` used in `migrate`
- `--force`/`-f` used in `db push`
- `--experimental-reintrospection` and `--clean` used in `db pull`

The use of `db push --force` can be replaced with the newer implementation `db push --accept-data-loss`.

All other flags are from previous APIs and are no longer needed.

### Removal of the <inlinecode>beforeExit</inlinecode> hook from the library engine

Instead of the existing `beforeExit` hook we recommend using built-in Node.js exit events.

The following code with Prisma 4:

```js
const exitHandler = () => {
  // your exit handler code
}

prisma.$on('beforeExit', exitHandler)
```

Could become:

```js
const exitHandler = () => {
  // your exit handler code
}

process.on('exit', exitHandler)
process.on('beforeExit', exitHandler)
process.on('SIGINT', exitHandler)
process.on('SIGTERM', exitHandler)
process.on('SIGUSR2', exitHandler)
```

### Removal of deprecated <inlinecode>prisma2</inlinecode> executable

When Prisma 2 was released a new executable, `prisma2` was added to the CLI in addition to the existing `prisma` executable. Today we are removing the extra executable.

If your scripts use `prisma2` with the Prisma CLI, please update `prisma2` to simply `prisma`.

### Removal of deprecated <inlinecode>experimentalFeatures</inlinecode> property

`previewFeatures` in a generator used to be called `experimentalFeatures`. We are finally removing that deprecated property.

Update references of `experimentalFeatures` to `previewFeatures` manually or use the new code action in the Prisma VSCode extension.

### Rename <inlinecode>migration-engine</inlinecode> to <inlinecode>schema-engine</inlinecode>

The engine responsible for commands like `prisma migrate` and `prisma db` has been renamed from `migration-engine` to `schema-engine` to better describe its use. For many users, no changes will be required. However, if you need to explicitly include the engine file for any reason, you will need to update your code references.

One example we have seen is projects using the Serverless Framework. In these instances, you may have rules such as:

```yaml
package:
  patterns:
    - '!node_modules/.prisma/client/libquery_engine-*'
    - 'node_modules/.prisma/client/libquery_engine-rhel-*'
    - '!node_modules/prisma/libquery_engine-*'
    - '!node_modules/prisma/migration-engine-*'
```

The rule `'!node_modules/prisma/migration-engine-*'` rule will need to be updated to match the new naming.

The [recommended rule from our documentation](https://www.prisma.io/docs/guides/deployment/deployment-guides/use-prisma-with-serverless-framework#lambda-functions-with-arm64-architectures) is not affected by this change.

```yaml highlight=6;normal
package:
  patterns:
    - '!node_modules/.prisma/client/libquery_engine-*'
    - 'node_modules/.prisma/client/libquery_engine-rhel-*'
    - '!node_modules/prisma/libquery_engine-*'
    - '!node_modules/@prisma/engines/**'
```

## Upgrade the <inlinecode>prisma</inlinecode> and <inlinecode>@prisma/client</inlinecode> packages to Prisma 5

To upgrade to Prisma 5 from an earlier version, you need to update both the `prisma` and `@prisma/client` packages. Both the `prisma` and `@prisma/client` packages install with a caret `^` in their version number. This allows upgrades to new minor versions, but not major versions, to safeguard against breaking changes.

To ignore the caret `^` and upgrade across major versions, you can use the `@5` tag when you upgrade with `npm`, or `yarn`:

<Admonition type="alert">

Before you upgrade, check each **breaking change** above to see how the upgrade might affect your application.

</Admonition>

<TabbedContent tabs={[<FileWithIcon text="npm" icon="file"/>, <FileWithIcon text="yarn" icon="file"/>]}>

<tab>

```terminal
npm install prisma@5 @prisma/client@5
```

</tab>

<tab>

```terminal
yarn upgrade prisma@5 @prisma/client@5
```

</tab>

</TabbedContent>

Enjoy Prisma 5!
